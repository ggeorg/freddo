(function(){window.DTalk={debug:!0,_ws:null,_connect:function(a){this._ws=new WebSocket(a||this.getURLParameter("ws"))},connect:function(a){if(window.XDTalk)try{this.getReadyState=function(){return 1},this.send=function(a){XDTalk.send(a)},this._subscribe=function(a,d){d&&DTalk._subscribeTo(a,d)},this._unsubscribe=function(a,d){d&&DTalk._unsubscribeFrom(a,d)},setTimeout(function(){DTalk.onopen&&DTalk.onopen.apply(DTalk,arguments);DTalk.publish("dtalk.onopen",{dtalk:"1.0",service:"dtalk.onopen"})},
0)}catch(b){console.error(b)}else if(window.AndroidDTalk)try{this.getReadyState=function(){return 1},this.send=function(a){AndroidDTalk.send(a)},this._subscribe=function(a,d){AndroidDTalk.subscribe(a);d&&DTalk._subscribeTo(a,d)},this._unsubscribe=function(a,d){AndroidDTalk.unsubscribe(a);d&&DTalk._unsubscribeFrom(a,d)},setTimeout(function(){DTalk.onopen&&DTalk.onopen.apply(DTalk,arguments);DTalk.publish("dtalk.onopen",{dtalk:"1.0",service:"dtalk.onopen"})},0)}catch(c){console.error(c)}else if(window.WebSocket||
(window.WebSocket=window.MozWebSocket),window.WebSocket)try{this._connect(a),this._ws.onopen=function(){DTalk.onopen&&DTalk.onopen.apply(DTalk,arguments);DTalk.publish("dtalk.onopen",{dtalk:"1.0",service:"dtalk.onopen"})},this._ws.onmessage=function(a){try{var d=JSON.parse(a.data);DTalk.publish(d.service,d)}catch(b){console.error(b)}},this._ws.onclose=function(){DTalk._ws=null;DTalk.onclose&&DTalk.onclose.apply(DTalk,arguments)},this._ws.onerror=function(){alert("WebSocket Error!")},this.getReadyState=
function(){return DTalk._ws.readyState},this.send=function(a){try{DTalk._ws.send(a)}catch(b){console.error(b)}},this._subscribe=function(a,b){DTalk.send(JSON.stringify({service:"dtalk.Dispatcher",action:"subscribe",params:a}));DTalk._subscribeTo(a,b)},this._unsubscribe=function(a,b){DTalk.send(JSON.stringify({service:"dtalk.Dispatcher",action:"unsubscribe",params:a}));DTalk._unsubscribeFrom(a,b)}}catch(e){console.error(e)}else alert("Your browser seems to not support WebSocket !")},onopen:null,onclose:null,
getReadyState:function(){return 3},_createEvent:function(a,b){var c=document.createEvent("Event");c.initEvent(a,!1,!1);b&&(c.data=b);return c},_publish:function(a,b){setTimeout(function(){try{DTalk.publish(a,JSON.parse(b))}catch(c){console.error(c)}},0)},publish:function(a,b){try{window.dispatchEvent(DTalk._createEvent(a,b))}catch(c){console.error(c)}},send:function(a){console.error("DTalk.send() is called before DTalk.connect().")},sendNotification:function(a){DTalk.send(JSON.stringify(a))},timerH:null,
sendRequest:function(a,b,c){a.id||(a.id=DTalk.createUniqueId(a.service));var e,f="to"in a?a.to:null,d=function(c){try{e&&clearTimeout(e),DTalk.removeEventListener(a.id,d,!0,f),b.call(this,c)}catch(g){console.error(g)}};DTalk.addEventListener(a.id,d,!0,f);e=setTimeout(function(){DTalk.removeEventListener(a.id,d,!0,f);var c=DTalk._createEvent(a.id,{dtalk:"1.0",service:a.id,error:"timeout"});b.call(this,c)},c||33333);DTalk.send(JSON.stringify(a))},addEventListener:function(a,b){var c=!1,e;try{window.addEventListener(a,
b,!1),3<=arguments.length&&"boolean"===typeof arguments[2]&&(c=arguments[2],3<arguments.length&&(e=arguments[3])),c&&1===DTalk.getReadyState()&&this._subscribe(a,e)}catch(f){console.error(f)}},removeEventListener:function(a,b){var c=!1,e;try{window.removeEventListener(a,b,!1),3<=arguments.length&&"boolean"===typeof arguments[2]&&(c=arguments[2],3<arguments.length&&(e=arguments[3])),c&&1===DTalk.getReadyState()&&this._unsubscribe(a,e)}catch(f){console.error(f)}},_subscribe:function(a,b){console.error("First open a connection before sending a message !")},
_subscribeTo:function(a,b){var c={service:"dtalk.Dispatcher",action:"subscribe",params:a};b&&(c.to=b);DTalk.send(JSON.stringify(c))},_unsubscribe:function(a,b){console.error("First open a connection before sending a message !")},_unsubscribeFrom:function(a,b){var c={service:"dtalk.Dispatcher",action:"unsubscribe",params:a};b&&(c.to=b);DTalk.send(JSON.stringify(c))},encode:function(a){return window.btoa(window.unescape(window.encodeURIComponent(a)))},decode:function(a){return window.decodeURIComponent(window.escape(window.atob(a)))},
_uniqueId:null,createUniqueId:function(a){DTalk._uniqueId||(DTalk._uniqueId=(new Date).getTime());return(a||"id")+DTalk._uniqueId++},getURLParam:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return null==a?"":decodeURIComponent(a[1])},getURLParameter:function(a){return decodeURIComponent((RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}};DTalk.addEventListener("freddo.websocket.reconnect",
function(a){alert(a.data.port);DTalk.connect("ws://localhost:"+parseInt(a.data.port)+"/dtalksrv")},!1)})();